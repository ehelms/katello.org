<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Disconnected</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/patternfly.css">
    <link rel="stylesheet" href="/assets/css/theme.css">
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="navbar-header">
    <a class="logo" href="/">
      <img src="/assets/images/default-logo.png" alt="Katello"/>
      <span>Katello</span>
    </a>
  </div>
  <div class="container">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" >Documentation<i class="caret"></i></a>
        <ul class="dropdown-menu">
          <li><a href="/docs">Nightly</a></li>
          <li><a href="/docs/2.0">2.0</a></li><li><a href="/docs/2.1">2.1</a></li>
        </ul>
      </li>
      <li>
        <a href="/developers">Developers</a>
      </li>
      <li>
        <a href="/community/index.html">Community</a>
      </li>
      <li>
        <a href="/troubleshooting/index.html">Troubleshooting</a>
      </li>
    </ul>
  </div>
</nav>


<div class="content">
  <h2 class="page-title">
    <div class="container">2.0: Disconnected</div>
  </h2>


  <section class="container has-sidebar">
    <nav class="context-nav">

  <ul>
    <li class="nav-item">
      <a href="/docs/2.0/installation/index.html">Installation</a>
    </li>
  </ul>
  <ul>
    <li class="nav-item">
      <a href="/docs/2.0/release_notes/release_notes.html">Release Notes</a>
    </li>
  </ul>
  <ul>
    <li class="nav-item">
      <a href="/docs/2.0/api/index.html">API</a>
    </li>
  </ul>
  <ul>
    <li class="nav-item">
      <a href="/docs/2.0/cli/index.html">CLI</a>
    </li>
  </ul>

  <ul>
  <li class="nav-item">
    <a href="#">User Guide</a>

    <ul class="sub-context-nav">
      
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/activation_keys/index.html">Activation Keys</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/capsules/index.html">Capsules</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/content/content.html">Content</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/content_hosts/index.html">Content Hosts</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/content_search/index.html">Content Search</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/content_views/content_views.html">Content Views</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/disconnected/index.html">Disconnected</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/glossary.html">Glossary</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/gpg_keys/index.html">GPG Keys</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/host_collections/index.html">Host Collections</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/lifecycle_environments/environment.html">Lifecycle Environments</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/provisioning/index.html">Provisioning</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/puppet_integration/index.html">Puppet Integration</a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/docs/2.0/user_guide/red_hat_content/content.html">Red Hat Content</a>
          </li>
        
      
        
      
        
      
        
      
        
      
    </ul>

  </li>
</ul>


</nav>



    <div class="section">
      
        <h1 id="katello-disconnected-utility">Katello Disconnected Utility</h1>

<h2 id="intro">Intro</h2>

<p>If you are working in an environment where you wish to synchronize content from Red Hat’s CDN and make available to your Katello servers that do not have a connection to the internet we have a utility that assists with this, known as katello-disconnected.  A diagram of the content flow is as follows:</p>

<p><img src="./katello-disconnected.png" alt="Disconnected Workflow" /></p>

<p><em>katello-disconnected</em> is used via a command line interface with a summary outlined here:</p>

<div class="highlight"><pre><code>katello-disconnected(1)        Katello Reference       katello-disconnected(1)

NAME
       katello-disconnected - Tool for fetching content from CDN

SYNOPSIS
         katello-disconnected [global_options] [subcommand [options]]

         Possible commands are:

             setup       set pulp configuration (oauth is required)
             import      import a manifest
             list        list all or enabled repositories
             enable      enable particular repository or all repos
             disable     disable particular repository or all repos
             configure   create and configure repositories in pulp
             sync        start synchronizing all or particular repos
             watch       watch synchronization progress
             export      export all or particular repos
             refresh     redownload repository information from CDN
             clean       remove all repositories from pulp

DESCRIPTION
       The katello-disconnected script communicates with pulp instance using REST and OAuth to synchronize repositories
       exporting them into a directory structure that can be imported into Katello later on. It is able to import a manifest
       file retrieving all provided products and repositories from the Red Hat CDN, creating those repositories in Pulp,
       initiating synchronization, watching the progress of a sync, exporting the content into a directory and refreshing
       already imported manifest.
</code></pre></div>

<h2 id="installation-steps">Installation Steps</h2>

<p>To start with <em>katello-disconnected</em> there are a series of steps you need to take to get it installed and configured. The installation should take place on your Synchronization Server seen above.  This system is the one that has access to the internet and Red Hat’s CDN servers.  These instructions point at the ‘‘katello nightly’’ builds but you can substitute this for the latest stable version of Katello if you desire.</p>

<p><strong>1)</strong> Configure repositories on your Synchronization Server:</p>

<p><strong>Enterprise Linux</strong></p>

<p>For Enterprise Linux, we require the Katello repos, EPEL and the appropriate set of Software Collection repositories for Ruby 1.9.3.</p>

<p>For EL6:</p>

<div class="highlight"><pre><code>$ rpm -Uvh http://fedorapeople.org/groups/katello/releases/yum/2.0/katello/RHEL/6/x86_64/katello-repos-latest.rpm
$ rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
$ rpm -Uvh https://www.softwarecollections.org/en/scls/rhscl/ruby193/epel-6-x86_64/download/rhscl-ruby193-epel-6-x86_64.noarch.rpm
$ rpm -Uvh http://yum.theforeman.org/releases/1.6/el6/x86_64/foreman-release.rpm
$ yum-config-manager --enable rhel-6-server-optional-rpms
</code></pre></div>

<p>For EL7:</p>

<div class="highlight"><pre><code>$ rpm -Uvh http://fedorapeople.org/groups/katello/releases/yum/2.0/katello/RHEL/7/x86_64/katello-repos-latest.rpm
$ rpm -Uvh http://download-i2.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-2.noarch.rpm
$ rpm -Uvh https://www.softwarecollections.org/en/scls/rhscl/v8314/epel-7-x86_64/download/rhscl-v8314-epel-7-x86_64.noarch.rpm
$ rpm -Uvh https://www.softwarecollections.org/en/scls/rhscl/ruby193/epel-7-x86_64/download/rhscl-ruby193-epel-7-x86_64.noarch.rpm
$ rpm -Uvh http://yum.theforeman.org/releases/1.6/el7/x86_64/foreman-release.rpm
$ yum-config-manager --enable rhel-7-server-optional-rpms
</code></pre></div>

<p><strong>Red Hat Enterprise Linux</strong></p>

<p>Katello requires your RHEL to be registered to Red Hat channels/repos. We also require the RHEL optional RPMs repo is enabled:</p>

<div class="highlight"><pre><code>$ yum-config-manager --enable rhel-6-server-optional-rpms
</code></pre></div>

<p>For RHEL 7:</p>

<div class="highlight"><pre><code>$ yum-config-manager --enable rhel-7-server-optional-rpms
</code></pre></div>

<p><strong>CentOS</strong></p>

<p>For CentOS, add the following:</p>

<div class="highlight"><pre><code>$ wget -O /etc/yum.repos.d/epel-rhsm.repo http://repos.fedorapeople.org/repos/candlepin/subscription-manager/epel-subscription-manager.repo
</code></pre></div>

<p><strong>2)</strong> Install katello-utils and associated RPMs:</p>

<div class="highlight"><pre><code>$ yum -y install python-qpid-qmf python-qpid  qpid-cpp-server-store katello-utils
</code></pre></div>

<p>This will install roughly 200 packages depending on your pre-existing configuration.</p>

<p><strong>3)</strong> Configure connection to pulp</p>

<p>You need to edit Pulp so it is allowed to authenticate with OAuth. Edit <code>/etc/pulp/server.conf</code> and look for the <code>[oauth]</code> section.  Uncomment and add values for the settings below.</p>

<p>You will need a new secret value which is a 32 char alpha numeric string, you can generate a new one with:</p>

<div class="highlight"><pre><code>$ tr -dc "[:alnum:]" &lt; /dev/urandom | head -c 32
tuqVww9ZmSYR6ROftJNOgn1O8NDJ3jqL
</code></pre></div>

<p>Copy paste that into the oauth_secret field in the <code>server.conf</code> file:</p>

<div class="highlight"><pre><code>[oauth]
enabled: true
oauth_key: katello
oauth_secret: tuqVww9ZmSYR6ROftJNOgn1O8NDJ3jqL
</code></pre></div>

<p>We also need to disable the qpidd authentication, open <code>/etc/qpid/qpidd.conf</code>:</p>

<div class="highlight"><pre><code># Configuration file for qpidd. Entries are of the form: 
#   name=value 
#
# (Note: no spaces on either side of '=').
# Run "qpidd --help" or see "man qpidd" for more details.

auth=no
</code></pre></div>

<p><strong>4)</strong> Configure <strong>katello-disconnected</strong> connection to Pulp:</p>

<div class="highlight"><pre><code>$ katello-disconnected setup --oauth-key=katello --oauth-secret=tuqVww9ZmSYR6ROftJNOgn1O8NDJ3jqL
</code></pre></div>

<p>This places a configuration value in ~/.katello-disconnected</p>

<p><strong>5)</strong>  Configure Pulp on your Synchronization Server that is connected to the internet</p>

<div class="highlight"><pre><code>service qpidd start
chkconfig qpidd on
service mongod start
sleep 10
chkconfig mongod on
sudo -u apache pulp-manage-db
service httpd restart
chkconfig pulp_workers on
service pulp_workers start
chkconfig pulp_celerybeat on
service pulp_celerybeat start
chkconfig pulp_resource_manager on
service pulp_resource_manager start
</code></pre></div>

<p><strong>6)</strong> Import manifest </p>

<p>You need to have a Subscription Manifest for this step.  You can read how to get one here: <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Customer_Portal/1/html/Red_Hat_Network_Certificate-based_Subscription_Management/managing-sam.html">Generate Subscription Manifest</a></p>

<div class="highlight"><pre><code>$ katello-disconnected import -m ./manifest.zip 
</code></pre></div>

<p>This sets up the list of available repositories to synchronize based on your subscriptions selected.</p>

<h2 id="syncing-content">Syncing Content</h2>

<p>By default <em>katello-disconnected</em> will enable <strong>all</strong> repos included in the manifest for syncing.  This is often far too much content to sync so first we disable </p>

<p><strong>1)</strong> disable all repos</p>

<div class="highlight"><pre><code>$ katello-disconnected disable --all
</code></pre></div>

<p><strong>2)</strong> list available repos to sync:</p>

<div class="highlight"><pre><code>$ katello-disconnected list --disabled
rhel-5-server-debug-rpms-5Server-i386
rhel-5-server-debug-rpms-5Server-ia64
rhel-5-server-debug-rpms-5Server-x86_64
rhel-5-server-debug-rpms-5_7-i386
rhel-5-server-debug-rpms-5_7-ia64
rhel-5-server-debug-rpms-5_7-x86_64
rhel-5-server-debug-rpms-5_8-i386
rhel-5-server-debug-rpms-5_8-ia64
rhel-5-server-debug-rpms-5_8-x86_64
rhel-5-server-debug-rpms-5_9-i386
rhel-5-server-debug-rpms-5_9-ia64
rhel-5-server-debug-rpms-5_9-x86_64
rhel-5-server-isos-5Server-i386
....
</code></pre></div>

<p><strong>3)</strong> enable a few a repo to sync:</p>

<div class="highlight"><pre><code>$ katello-disconnected enable -r rhel-6-server-sam-rpms-6_4-x86_64
</code></pre></div>

<p><strong>4)</strong> push and create the repositories in Pulp to allow synchronization:</p>

<p>Any time you enable or disable a repository you need to remember to call the <code>configure</code> command</p>

<div class="highlight"><pre><code>$ katello-disconnected configure
</code></pre></div>

<p><strong>5)</strong> sync the repos </p>

<p>Now that Pulp is all setup to synchronize content you can call the sync and watch command:</p>

<div class="highlight"><pre><code>$ katello-disconnected sync
$ katello-disconnected watch
Watching... (this may be safely interrupted with Ctrl+C)
State: running:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: running:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: running:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]
...
...
Watching finished
</code></pre></div>

<p>Once it is done you are able to now export the content.</p>

<h2 id="exporting-content">Exporting Content</h2>

<p><strong>1)</strong> Export the synced repos</p>

<div class="highlight"><pre><code>$ katello-disconnected export -t /var/tmp/export
Waiting for repos to finish publishing
Watching... (this may be safely interrupted with Ctrl+C)
State: waiting:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: waiting:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: waiting:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: waiting:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]

State: finished:
  repo: [rhel-6-server-optional-rpms-6_5-x86_64] packages remaining: [unknown]


Watching finished
Done watching ...
 Archiving contents of /var/tmp/export into 4600M tar archives.
 NOTE: This may take a while.

Done exporting content, please copy /var/tmp/export/* to your disconnected host
</code></pre></div>

<p>Now if you look in <code>/var/tmp/export</code> you will see:</p>

<div class="highlight"><pre><code>$ ls /var/tmp/export/
content-export-00 content-export-01 content-export-02 expand_export.sh
</code></pre></div>

<p>These files can be burned to a series of DVDs based on the number sequence.  They are then expanded and re-assembled using the ‘expand_export.sh’ script contained within.  </p>

<h2 id="re-importing-into-your-disconnected-katello-server">Re-Importing into your disconnected Katello Server</h2>

<p>Copy the contents of your export to a directory on your disconnected Katello Server as shown in the diagram above.  Presently, if you think you will be doing multiple exports over time, copy these directly into <code>/var/www/html</code></p>

<p><strong>1)</strong> Run the ‘expand_export.sh’:</p>

<div class="highlight"><pre><code>$ cd /var/www/html
$ ./expand_export.sh 
*** Done expanding archives. ***
</code></pre></div>

<p><strong>***WARNING***</strong>: Ensure that the directory and filesystem containing the exports has enough space to expand out the archives. This means if your export is 40G you will need an extra 40G of space to expand it on the same filesystem.</p>

<p><strong>2)</strong> Restore the SELinux contexts on the moved files:</p>

<div class="highlight"><pre><code>$ cd /var/www/html
$ restorecon -r *
</code></pre></div>

<p>At this point your local Disconnected Katello Server is now acting as its own CDN with the files now located on <code>http://localhost/content</code>.  You don’t have to do this on your Katello server itself, it can be any host on the same disconnected network inside your environment.  You just need to make it accessible via HTTP to your Katello Server.</p>

<p><strong>2)</strong> Change CDN URL and import manifest into Katello Server</p>

<ul>
  <li>Login to your Katello WebUI</li>
  <li>Navigate to: <em>Content -&gt; Subscriptions -&gt; Red Hat Subscriptions</em></li>
  <li>Change the CDN URL to: <code>http://localhost</code></li>
  <li>Import your manifest, same one used above on your disconnected host using the Upload mechanism</li>
</ul>

<p><strong>3)</strong> Enable repositories and sync repos</p>

<p>Now that your manifest is imported you can sync your repos in from your locally copied CDN.  </p>

<ul>
  <li>Navigate to <em>Content -&gt; Repositories -&gt; Red Hat Repositories</em></li>
  <li>Enable the repositories here that you also enabled and synced from <a href="#syncing-content">Syncing Content</a> above</li>
  <li>Navigate to <em>Content -&gt; Sync Management</em>.  Select and synchronize the repos listed on the page</li>
</ul>

<p>At this point you are done and able to create Content Views, promote your content, subscribe systems and use Katello as if it was connected. We recommend that you remove the exported content archive and export script from <code>/var/www/html</code> to avoid any issues that might arise with future imports.</p>

<div class="highlight"><pre><code>$ cd /var/www/html
$ rm content-export-* expand_export.sh
</code></pre></div>

<p><strong>Note:</strong> If you subsequently import content into a product for which you have previously created repos (i.e., you import an i386 tree for a product where you’ve previously imported the  x86_64 content), it may not be readily available in the UI.  To resolve this, force a refresh of the cdn data:</p>

<div class="highlight"><pre><code>$ /etc/cron.daily/katello-refresh-cdn
</code></pre></div>

      
    </div>
  </section>

</div>


    <footer class="footer">
    <p>This web site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_GB">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.  Source available: <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/katello/katello.org" rel="dct:source">github.com/katello/katello.org</a>.</p>
</footer>


    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
  </body>
</html>
