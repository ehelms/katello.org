<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Testing</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" href="/assets/css/font-awesome.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/patternfly.css">
    <link rel="stylesheet" href="/assets/css/theme.css">
  </head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="navbar-header">
    <a class="logo" href="/">
      <img src="/assets/images/default-logo.png" alt="Katello"/>
      <span>Katello</span>
    </a>
  </div>
  <div class="container">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" >Documentation<i class="caret"></i></a>
        <ul class="dropdown-menu">
          <li><a href="/docs">Nightly</a></li>
          <li><a href="/docs/2.0">2.0</a></li><li><a href="/docs/2.1">2.1</a></li>
        </ul>
      </li>
      <li>
        <a href="/developers">Developers</a>
      </li>
      <li>
        <a href="/community/index.html">Community</a>
      </li>
      <li>
        <a href="/troubleshooting/index.html">Troubleshooting</a>
      </li>
    </ul>
  </div>
</nav>


<div class="content">
  <h2 class="page-title">
    <div class="container">Testing</div>
  </h2>


  <section class="container has-sidebar">
    <nav class="context-nav">

  <ul>
    <li class="nav-item">
      <a href="#">Developer Guide</a>

      <ul class="sub-context-nav">
        
          
        
          
            
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
            
          
        
          
            
              <li class="nav-item">
                <a href="/developers/github_workflow.html">Github Workflow</a>
              </li>
            
          
        
          
        
          
            
              <li class="nav-item">
                <a href="/developers/hammer_dev_env.html">Hammer Dev Environment</a>
              </li>
            
          
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
        
          
        
          
            
          
        
          
        
          
            
          
        
          
            
              <li class="nav-item">
                <a href="/developers/pull_request_checklist.html">Pull Request Checklist</a>
              </li>
            
          
        
          
        
          
            
          
        
          
            
              <li class="nav-item">
                <a href="/developers/testing.html">Testing</a>
              </li>
            
          
        
          
            
              <li class="nav-item">
                <a href="/developers/upgrade_pulp.html">Upgrading Pulp</a>
              </li>
            
          
        
      </ul>
    </li>
  </ul>

  <ul>
  <li class="nav-item">
    <a href="#">Style Guides</a>

    <ul class="sub-context-nav">
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/developers/style/git_commit_messages.html">Style Guide: Commit Messages</a>
          </li>
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/developers/style/javascript.html">Style Guide: Javascript</a>
          </li>
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/developers/style/ruby.html">Style Guide: Ruby</a>
          </li>
        
      
        
      
        
      
    </ul>

  </li>
</ul>

  <ul>
  <li class="nav-item">
    <a href="/docs/developer_guide/bastion">Bastion</a>

    <ul class="sub-context-nav">
      
        
      
        
          
            <li class="nav-item">
              <a href="/developers/bastion/add_custom_module.html">Bastion: Adding a Custom Module</a>
            </li>
          
        
      
        
          
            <li class="nav-item">
              <a href="/developers/bastion/add_entity.html">Bastion: Add Entity</a>
            </li>
          
        
      
        
      
        
      
        
      
        
      
        
      
        
          
            <li class="nav-item">
              <a href="/developers/bastion/dependencies.html">Bastion: Dependencies</a>
            </li>
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
            <li class="nav-item">
              <a href="/developers/bastion/i18n.html">Bastion: i18n</a>
            </li>
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>

  </li>
</ul>


</nav>



    <div class="section">
      
        <h1 id="speeding-up-tests">Speeding up tests</h1>

<p>Running the tests in Katello can take quite a while, especially the ruby ones.<br />
This guide will help in trying to speed up your testing workflow by giving you<br />
some tips.</p>

<h2 id="when-to-run-tests">When to run tests</h2>

<p>An important part of testing is knowing which tests to run and when. This can<br />
save you a lot of time. </p>

<p>Very rarely should you run the entire test suite locally. Instead, just let<br />
Jenkins run it for you after you open a PR. Locally, run new tests you write<br />
along with any tests you think might be affected.</p>

<p>To run an individual file:</p>

<div class="highlight"><pre><code>rake test:katello TEST=../katello/test/models/content_view_test.rb
</code></pre></div>

<p>To run an individual test:</p>

<div class="highlight"><pre><code># testunit style
rake test:katello TEST=../katello/test/models/content_view_test.rb TESTOPTS="-ntest_create"

# spec style
rake test:katello TEST=../katello/test/actions/katello/environment_test.rb TESTOPTS="-n/plans/"
</code></pre></div>

<h2 id="tools-to-speed-up-testing">Tools to speed up testing</h2>

<p>One of the reasons the Rails tests take such a long time is that the Rails<br />
environment must be loaded. There are some tools to help get around this.</p>

<h3 id="rail-preloaders">Rail preloaders</h3>

<p>Rails preloaders work by loading up your Rails environment in the background and then waiting for<br />
whenever you have to run tests. They can also speed up other boot times like running Rails console<br />
or Rails server.</p>

<ul>
  <li><a href="https://github.com/rails/spring">spring</a> - a basic one from the Rails team</li>
  <li><a href="https://github.com/burke/zeus">zeus</a> - more features than spring.</li>
</ul>

<h3 id="ktest">ktest</h3>

<p>Another simple way to speed up tests is by skipping some of the loading and pre-test tasks by<br />
running Ruby directly. This script will speed up your load time by as much as 30-60 seconds. Simply<br />
copy the code below into a script file in your PATH (e.g. ~/.bin/ktest).</p>

<div class="highlight"><pre><code class="language-sh"><span class="c">#!/usr/bin/env sh</span>

<span class="nv">KATELLO_PATH</span><span class="o">=</span>/path/to/your/katello/project

<span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$1</span> <span class="o">]]</span>
<span class="k">then</span>
  <span class="nv">RAKE_PATH</span><span class="o">=</span><span class="sb">`</span>bundle show rake<span class="sb">`</span>
  ruby -I<span class="s2">&quot;lib:test:${KATELLO_PATH}/test:${KATELLO_PATH}/spec&quot;</span> -I<span class="s2">&quot;${RAKE_PATH}/lib&quot;</span> <span class="se">\</span>
    <span class="s2">&quot;${RAKE_PATH}/lib/rake/rake_test_loader.rb&quot;</span> <span class="nv">$@</span> <span class="k">${</span><span class="nv">KATELLO_PATH</span><span class="k">}</span>/test/katello_test_runner.rb
<span class="k">else</span>
  bundle <span class="nb">exec </span>rake <span class="nb">test</span>:katello
<span class="k">fi</span></code></pre></div>

<p>Then you can run a test file like so:</p>

<div class="highlight"><pre><code>ktest ../katello/test/models/content_view_test.rb
</code></pre></div>

<p>Or run an individual test:</p>

<div class="highlight"><pre><code>ktest ../katello/test/models/content_view_test.rb -ntest_create
</code></pre></div>

<p>You can even record your glue tests:</p>

<div class="highlight"><pre><code>mode=all ktest ../katello/test/models/glue/repository_test.rb
</code></pre></div>

<p>One thing to note is that while the normal rake test command will migrate the database, ktest will<br />
not (in the interest of saving time). To do this, simply run this in your foreman directory:</p>

<div class="highlight"><pre><code>RAILS_ENV=test rake db:drop &amp;&amp; RAILS_ENV=test rake db:create &amp;&amp; RAILS_ENV=test rake db:migrate
</code></pre></div>

<p>Or if you’re a CLI ninja, you can alias it:</p>

<div class="highlight"><pre><code>alias testdb='RAILS_ENV=test rake db:drop &amp;&amp; RAILS_ENV=test rake db:create &amp;&amp; RAILS_ENV=test rake db:migrate'
</code></pre></div>

      
    </div>
  </section>

</div>


    <footer class="footer">
    <p>This web site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/deed.en_GB">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.  Source available: <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/katello/katello.org" rel="dct:source">github.com/katello/katello.org</a>.</p>
</footer>


    <script src="/assets/js/jquery.min.js"></script>
    <script src="/assets/js/bootstrap.min.js"></script>
  </body>
</html>
